namespace = fi_ai_investment

fi_ai_investment.1 = {
	type = country_event
	hidden = yes

	trigger = {
		OR = {
			has_variable = fi_identification
			country_rank >= rank_value:great_power
		}
		market_capital = { owner = root }
		has_wasted_construction = yes
		investment_pool > 500000
		construction_queue_private_duration < 31
		OR = {
			is_ai = yes
			has_variable = fi_toggle_on
		}
		NOT = { has_law = law_type:law_command_economy } 
	}

	immediate = {
		save_scope_as = investor_country
		
		while = {
			limit = {
				has_wasted_construction = yes
				construction_queue_private_duration < 31
			}
			count = ai_construct_how_many_building
			random_list = {
				4 = { set_variable = fi_target_building_gold }
				3 = { set_variable = fi_target_building_oil }
				2 = { set_variable = fi_target_building_profit }
				1 = { set_variable = fi_target_building_random }
			}
			random_list = {
				5 = { set_variable = fi_target_highgdp }
				4 = { set_variable = fi_target_subject }
				1 = { set_variable = fi_target_random }
			}
			
			if = {
				limit = {
					has_variable = fi_target_building_gold
				}
				if = {
					limit = {
						has_variable = fi_target_highgdp
					}
					ordered_country ={
						limit = {
							check_investable = yes
							NOT = {this = root}
							ai_check_can_construct = {
								BUILDING = building_gold_mine
							}
							OR = {
								NOT = { has_variable = mine_exclusive }
								var:mine_exclusive = root.var:fi_identification
							}
						}
						order_by = gdp
						check_range_bounds = no
						max = 1
						save_scope_as = target_country
					}
				}
				else_if = {
					limit = {
						has_variable = fi_target_subject
					}
					random_country ={
						limit = {
							is_subject_of = root
							NOT = {this = root}
							ai_check_can_construct = {
								BUILDING = building_gold_mine
							}
							OR = {
								NOT = { has_variable = mine_exclusive }
								var:mine_exclusive = root.var:fi_identification
							}
						}
						save_scope_as = target_country
					}
				}
				else_if = {
					limit = {
						has_variable = fi_target_random
					}
					random_country ={
						limit = {
							NOT = {this = root}
							OR = {
								NOT = { has_variable = mine_exclusive }
								var:mine_exclusive = root.var:fi_identification
							}
							check_investable = yes
							ai_check_can_construct = {
								BUILDING = building_gold_mine
							}
						}
						save_scope_as = target_country
					}
				}
				if = {
					limit = { 
						exists = scope:target_country 
					}
					fi_ai_construct = { BUILDING = building_gold_mine }
				}
			}
			else_if = {
				limit = {
					has_variable = fi_target_building_oil
					has_technology_researched = pumpjacks
				}
				if = {
					limit = {
						has_variable = fi_target_highgdp
					}
					ordered_country ={
						limit = {
							check_investable = yes
							NOT = {this = root}
							ai_check_can_construct = {
								BUILDING = building_oil_rig
							}
						}
						order_by = gdp
						check_range_bounds = no
						max = 1
						save_scope_as = target_country
					}
				}
				else_if = {
					limit = {
						has_variable = fi_target_subject
					}
					random_country ={
						limit = {
							is_subject_of = root
							ai_check_can_construct = {
								BUILDING = building_oil_rig
							}
							NOT = {this = root}
						}
						save_scope_as = target_country
					}
				}
				else_if = {
					limit = {
						has_variable = fi_target_random
					}
					random_country ={
						limit = {
							check_investable = yes
							NOT = {this = root}
							ai_check_can_construct = {
								BUILDING = building_oil_rig
							}
						}
						save_scope_as = target_country
					}
				}
				if = {
					limit = { 
						exists = scope:target_country 
					}
					fi_ai_construct = { BUILDING = building_oil_rig }
				}
			}
			else_if = {
				limit = {
					has_variable = fi_target_building_profit
				}
				if = {
					limit = {
						has_variable = fi_target_highgdp
					}
					ordered_country ={
						limit = {
							check_investable = yes
							OR = {
								NOT = { has_variable = mine_exclusive }
								var:mine_exclusive = root.var:fi_identification
							}
							NOT = {this = root}
							ai_check_can_construct_random = yes
						}
						order_by = gdp
						check_range_bounds = no
						max = 1
						save_scope_as = target_country
					}
				}
				else_if = {
					limit = {
						has_variable = fi_target_subject
					}
					random_country ={
						limit = {
							is_subject_of = root
							ai_check_can_construct_random = yes
							NOT = {this = root}
							OR = {
								NOT = { has_variable = mine_exclusive }
								var:mine_exclusive = root.var:fi_identification
							}
						}
						save_scope_as = target_country
					}
				}
				else_if = {
					limit = {
						has_variable = fi_target_random
					}
					random_country ={
						limit = {
							check_investable = yes
							ai_check_can_construct_random = yes
							NOT = {this = root}
							OR = {
								NOT = { has_variable = mine_exclusive }
								var:mine_exclusive = root.var:fi_identification
							}
						}
						save_scope_as = target_country
					}
				}
				if = {
					limit = { 
						exists = scope:target_country
					}
					scope:target_country = {
						ordered_scope_building = {
							limit = {
								OR ={
									AND = {
										is_building_type = building_coal_mine
										building_coal_mine_can_queue = yes
									}
									AND = {
										is_building_type = building_iron_mine
										building_iron_mine_can_queue = yes
									}
									AND = {
										is_building_type = building_lead_mine
										building_lead_mine_can_queue = yes
									}
									AND = {
										is_building_type = building_sulfur_mine
										building_sulfur_mine_can_queue = yes
									}
									AND = {
										is_building_type = building_logging_camp
										building_logging_camp_can_queue = yes
									}
									AND = {
										is_building_type = building_railway
										building_railway_can_queue = yes
									}
                                    AND = {
                                            is_building_type = building_food_industry
                                            building_food_industry_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_textile_mills
                                            building_textile_mills_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_furniture_manufacturies
                                            building_furniture_manufacturies_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_glassworks
                                            building_glassworks_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_tooling_workshops
                                            building_tooling_workshops_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_paper_mills
                                            building_paper_mills_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_chemical_plants
                                            building_chemical_plants_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_synthetics_plants
                                            building_synthetics_plants_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_steel_mills
                                            building_steel_mills_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_motor_industry
                                            building_motor_industry_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_shipyards
                                            building_shipyards_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_war_machine_industry
                                            building_war_machine_industry_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_electrics_industry
                                            building_electrics_industry_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_arms_industry
                                            building_arms_industry_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_munition_plants
                                            building_munition_plants_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_arts_academy
                                            building_arts_academy_can_queue = yes
                                    }
                                    AND = {
                                            is_building_type = building_power_plant
                                            building_power_plant_can_queue = yes
                                    }
								}
								occupancy > 0.95
                  				cash_reserves_ratio > 0.95
							}
							order_by = weekly_profit
							check_range_bounds = no
							max = 1
							save_scope_as = fi_target_building
						}
					}
					if = {
						limit = {
							NOT = { exists = scope:fi_target_building }
						}
					}
					else_if = {
						limit = {
							scope:fi_target_building = { is_building_type = building_coal_mine }
						}
						fi_ai_construct = {BUILDING = building_coal_mine}
					}
					else_if = {
						limit = {
							scope:fi_target_building = { is_building_type = building_iron_mine }
						}
						fi_ai_construct = {BUILDING = building_iron_mine}
					}
					else_if = {
						limit = {
							scope:fi_target_building = { is_building_type = building_lead_mine }
						}
						fi_ai_construct = {BUILDING = building_lead_mine}
					}
					else_if = {
						limit = {
							scope:fi_target_building = { is_building_type = building_sulfur_mine }
						}
						fi_ai_construct = {BUILDING = building_sulfur_mine}
					}
					else_if = {
						limit = {
							scope:fi_target_building = { is_building_type = building_logging_camp }
						}
						fi_ai_construct = {BUILDING = building_logging_camp}
					}
					else_if = {
						limit = {
							scope:fi_target_building = { is_building_type = building_rubber_plantation }
						}
						fi_ai_construct = {BUILDING = building_rubber_plantation}
					}
					else_if = {
						limit = {
							scope:fi_target_building = { is_building_type = building_railway }
						}
						fi_ai_construct = {BUILDING = building_railway}
					}
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_food_industry }
                            }
                            fi_ai_construct = {BUILDING = building_food_industry }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_textile_mills }
                            }
                            fi_ai_construct = {BUILDING = building_textile_mills }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_furniture_manufacturies }
                            }
                            fi_ai_construct = {BUILDING = building_furniture_manufacturies }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_glassworks }
                            }
                            fi_ai_construct = {BUILDING = building_glassworks }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_tooling_workshops }
                            }
                            fi_ai_construct = {BUILDING = building_tooling_workshops }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_paper_mills }
                            }
                            fi_ai_construct = {BUILDING = building_paper_mills }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_chemical_plants }
                            }
                            fi_ai_construct = {BUILDING = building_chemical_plants }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_synthetics_plants }
                            }
                            fi_ai_construct = {BUILDING = building_synthetics_plants }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_steel_mills }
                            }
                            fi_ai_construct = {BUILDING = building_steel_mills }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_motor_industry }
                            }
                            fi_ai_construct = {BUILDING = building_motor_industry }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_shipyards }
                            }
                            fi_ai_construct = {BUILDING = building_shipyards }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_war_machine_industry }
                            }
                            fi_ai_construct = {BUILDING = building_war_machine_industry }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_electrics_industry }
                            }
                            fi_ai_construct = {BUILDING = building_electrics_industry }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_arms_industry }
                            }
                            fi_ai_construct = {BUILDING = building_arms_industry }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_munition_plants }
                            }
                            fi_ai_construct = {BUILDING = building_munition_plants }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_arts_academy }
                            }
                            fi_ai_construct = {BUILDING = building_arts_academy }
                    }
                    else_if = {
                            limit = {
                                    scope:fi_target_building = { is_building_type = building_power_plant }
                            }
                            fi_ai_construct = {BUILDING = building_power_plant }
                    }
				}
			}
			else_if = {
				limit = {
					has_variable = fi_target_building_random
				}
				if = {
					limit = {
						has_variable = fi_target_highgdp
					}
					ordered_country ={
						limit = {
							check_investable = yes
							ai_check_can_construct_random = yes
							NOT = {this = root}
							OR = {
								NOT = { has_variable = mine_exclusive }
								var:mine_exclusive = root.var:fi_identification
							}
						}
						order_by = gdp
						check_range_bounds = no
						max = 1
						save_scope_as = target_country
					}
				}
				else_if = {
					limit = {
						has_variable = fi_target_subject
					}
					random_country ={
						limit = {
							is_subject_of = root
							ai_check_can_construct_random = yes
							NOT = {this = root}
							OR = {
								NOT = { has_variable = mine_exclusive }
								var:mine_exclusive = root.var:fi_identification
							}
						}
						save_scope_as = target_country
					}
				}
				else_if = {
					limit = {
						has_variable = fi_target_random
					}
					random_country ={
						limit = {
							check_investable = yes
							ai_check_can_construct_random = yes
							NOT = {this = root}
							OR = {
								NOT = { has_variable = mine_exclusive }
								var:mine_exclusive = root.var:fi_identification
							}
						}
						save_scope_as = target_country
					}
				}
				if = {
					limit = { 
						exists = scope:target_country
					}
					random_list = {
						1 = {fi_ai_construct = {BUILDING = building_coal_mine}}
						1 = {fi_ai_construct = {BUILDING = building_iron_mine}}
						1 = {fi_ai_construct = {BUILDING = building_lead_mine}}
						1 = {fi_ai_construct = {BUILDING = building_sulfur_mine}}
						1 = {fi_ai_construct = {BUILDING = building_logging_camp}}
						1 = {fi_ai_construct = {BUILDING = building_rubber_plantation}}
						1 = {fi_ai_construct = {BUILDING = building_railway}}
					}
				}
			}
			remove_variable = fi_target_building_gold
			remove_variable = fi_target_building_oil
			remove_variable = fi_target_building_profit
			remove_variable = fi_target_building_random
			remove_variable = fi_target_highgdp
			remove_variable = fi_target_subject
			remove_variable = fi_target_random
		}	
	}
}
